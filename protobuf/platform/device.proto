syntax = "proto3";

package platform;

option go_package = "github.com/adarko-io/platform-api/go/v4/platform";

import "google/api/annotations.proto";
import "google/protobuf/timestamp.proto";
import "google/protobuf/empty.proto";
import "platform/shared_enums.proto";
import "google/protobuf/struct.proto";


// DeviceService is the service providing API methods for managing devices.
service DeviceService {
  // Create the given device.
  rpc Create(CreateDeviceRequest) returns (google.protobuf.Empty) {
    option (google.api.http) = {
      post: "/api/devices"
      body: "*"
    };
  }

  // Get returns the device for the given EUI.
  rpc Get(GetDeviceRequest) returns (GetDeviceResponse) {
    option (google.api.http) = {
      get: "/api/devices/{eui}"
    };
  }

  // Update the given device.
  rpc Update(UpdateDeviceRequest) returns (google.protobuf.Empty) {
    option (google.api.http) = {
      put: "/api/devices/{device.eui}"
      body: "*"
    };
  }

  // Delete the device with the given EUI.
  rpc Delete(DeleteDeviceRequest) returns (google.protobuf.Empty) {
    option (google.api.http) = {
      delete: "/api/devices/{eui}"
    };
  }

  // Get the list of devices.
  rpc List(ListDevicesRequest) returns (ListDevicesResponse) {
    option (google.api.http) = {
      get: "/api/devices"
    };
  }

  // GetDevicesSummary returns an aggregated summary of the devices (online,offline,never seen based DeviceType, TransportProtocol, AssetType, AssetSubType , tenantid, applicationid).
    rpc GetDevicesSummary(GetDevicesSummaryRequest) returns (GetDevicesSummaryResponse) {
        option(google.api.http) = {
            get: "/api/devices-summary"
        };
    }


}

message GetDevicesSummaryRequest {
    // Application ID (UUID) to filter devices on.
    string application_id = 1;

    // Tenant ID (UUID) to filter devices on.
    string tenant_id = 2;

    // Device Type.
    DeviceType device_type = 3;

    //Asset Type Water Meter, Gas Meter, Energy Meter etc.
    AssetType asset_type = 4;

    //Asset Sub Type
    AssetSubType asset_sub_type = 5;

    // Device Transport Protocol
    TransportProtocol transport_protocol = 6;

}

message GetDevicesSummaryResponse {
    // Total number of devices.
    uint32 total_count = 1;

    // Number of online devices.
    uint32 online_count = 2;

    // Number of offline devices.
    uint32 offline_count = 3;

    // Number of never seen devices.
    uint32 never_seen_count = 4;
  }

message Device {
  // EUI (EUI64).
  string eui = 1;

  // Name.
  string name = 2;

  // Description.
  string description = 3;

  // Application ID (UUID).
  string application_id = 4;

  // Device is disabled.
  bool is_disabled = 5;

  // SerialNo.
  string serial_number = 6;

  // Device Type.
  DeviceType device_type = 7;

  //Asset Type Water Meter, Gas Meter, Energy Meter etc.
  AssetType asset_type = 8;

  //Asset Sub Type
  AssetSubType asset_sub_type = 9;

  // Device Transport Protocol
  TransportProtocol transport_protocol = 10;

  // Expected update interval in seconds.
  uint32 expected_update_interval_in_sec = 11;

  // Variables (user defined).
  // These variables can be used together with integrations to store tokens /
  // secrets that must be configured per device. These variables are not
  // exposed in the event payloads.
  map<string, string> variables = 12;

  // Tags (user defined).
  // These tags can be used to add additional information to the device.
  // These tags are exposed in all the integration events.
  map<string, string> tags = 13;

  // Location information.
  Location location = 14;

}

message DeviceStatus {
  // Processed data (JSON string containing decoded sensor readings).
  google.protobuf.Value data = 1;
  // Last seen at timestamp.
  google.protobuf.Timestamp last_seen_at = 2;
   //is online 
  bool is_online = 3;
}

message DeviceListItem {
  // EUI (EUI64).
  string eui = 1;

  // Created at timestamp.
  google.protobuf.Timestamp created_at = 2;

  // Last update timestamp.
  google.protobuf.Timestamp updated_at = 3;

  // Name.
  string name = 4;

  // Description.
  string description = 5;

  // Device-profile ID (UUID).
  string device_profile_id = 6;

  // Device-profile name.
  string device_profile_name = 7;

  // Device status.
  DeviceStatus device_status = 8;

  // Asset Type
  AssetType asset_type = 9;

  // Device tags.
  map<string, string> tags = 10;
}

message CreateDeviceRequest {
  // Device object.
  Device device = 1;
}

message GetDeviceRequest {
  // EUI (EUI64).
  string eui = 1;
}

message GetDeviceResponse {
  // Device object.
  Device device = 1;

  // Created at timestamp.
  google.protobuf.Timestamp created_at = 2;

  // Last update timestamp.
  google.protobuf.Timestamp updated_at = 3;

  // Device status.
  DeviceStatus device_status = 4;

}

message UpdateDeviceRequest {
  // Device object.
  Device device = 1;
}

message DeleteDeviceRequest {
  // EUI (EUI64).
  string eui = 1;
}

message ListDevicesRequest {
  // Max number of devices to return in the result-set.
  // If not set, it will be treated as 0, and the response will only return the total_count.
  uint32 limit = 1;

  // Offset in the result-set (for pagination).
  uint32 offset = 2;

  // If set, the given string will be used to search on name (optional).
  string search = 3;

  // Application ID (UUID) to filter devices on.
  string application_id = 4;

  enum OrderBy {
    NAME = 0;
    EUI = 1;
    LAST_SEEN_AT = 2;
    DEVICE_PROFILE_NAME = 3;
  }

  // If set, the given value will be used to sort by (optional).
  OrderBy order_by = 5;

  // If set, the sorting direction will be decending (default = ascending) (optional).
  bool order_by_desc = 6;

  // Tags to filter devices on.
  map<string, string> tags = 7;


}

message ListDevicesResponse {
  // Total number of devices.
  uint32 total_count = 1;

  // Result-set.
  repeated DeviceListItem result = 2;
}
