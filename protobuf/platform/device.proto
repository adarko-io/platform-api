syntax = "proto3";

package platform;

option go_package = "github.com/adarko-io/platform-api/go/v4/platform";

import "google/api/annotations.proto";
import "google/protobuf/timestamp.proto";
import "google/protobuf/empty.proto";
import "platform/shared_enums.proto";
import "google/protobuf/struct.proto";


// DeviceService is the service providing API methods for managing devices.
service DeviceService {
  // Create the given device.
  rpc Create(CreateDeviceRequest) returns (CreateDeviceResponse) {
    option (google.api.http) = {
      post: "/api/devices"
      body: "*"
    };
  }

  // Get returns the device for the given EUI.
  rpc Get(GetDeviceRequest) returns (GetDeviceResponse) {
    option (google.api.http) = {
      get: "/api/devices/{id}"
    };
  }

  // Update the given device.
  rpc Update(UpdateDeviceRequest) returns (google.protobuf.Empty) {
    option (google.api.http) = {
      put: "/api/devices/{device.id}"
      body: "*"
    };
  }

  // Delete the device with the given EUI.
  rpc Delete(DeleteDeviceRequest) returns (google.protobuf.Empty) {
    option (google.api.http) = {
      delete: "/api/devices/{id}"
    };
  }

  // Get the list of devices.
  rpc List(ListDevicesRequest) returns (ListDevicesResponse) {
    option (google.api.http) = {
      get: "/api/devices"
    };
  }

  // GetDevicesSummary returns an aggregated summary of the devices (online,offline,never seen based DeviceType, TransportProtocol, AssetType, AssetSubType , tenantid, applicationid).
    rpc GetDevicesSummary(GetDevicesSummaryRequest) returns (GetDevicesSummaryResponse) {
        option(google.api.http) = {
            get: "/api/devices-summary"
        };
    }


}

message GetDevicesSummaryRequest {
    // Application ID (UUID) to filter devices on.
    string application_id = 1;

    // Tenant ID (UUID) to filter devices on.
    string tenant_id = 2;

    // Device Type.
    DeviceType device_type = 3;

    //Asset Type Water Meter, Gas Meter, Energy Meter etc.
    AssetType asset_type = 4;

    //Asset Sub Type
    AssetSubType asset_sub_type = 5;

    // Device Transport Protocol
    TransportProtocol transport_protocol = 6;

    //Device Profile ID
    string device_profile_id = 7;

}

message GetDevicesSummaryResponse {
    // Total number of devices.
    uint32 total_count = 1;

    // Number of online devices.
    uint32 online_count = 2;

    // Number of offline devices.
    uint32 offline_count = 3;

    // Number of never seen devices.
    uint32 never_seen_count = 4;
  }

message Device {
  //ID
  string id = 1;

  // EUI (EUI64).
  string eui = 2;

  // Name.
  string name = 3;

  // Description.
  string description = 4;

  // Application ID (UUID).
  string application_id = 5;

  // Tenant ID (UUID).
  string tenant_id = 6;

  // Device is disabled.
  bool is_disabled = 7;

  // SerialNo.
  string serial_number = 8;

  //Device Profile ID
  string device_profile_id = 9;

  //Inventory ID
  string inventory_id =  10;

  // Expected update interval in seconds.
  uint32 expected_update_interval_in_sec = 15;

  // Variables (user defined).
  // These variables can be used together with integrations to store tokens /
  // secrets that must be configured per device. These variables are not
  // exposed in the event payloads.
  map<string, string> variables = 16;

  // Tags (user defined).
  // These tags can be used to add additional information to the device.
  // These tags are exposed in all the integration events.
  map<string, string> tags = 17;

  // Location information.
  Location location = 18;

  //Parent Device ID in case of isParentDevice=false;
  string parent_device_id = 19;

  DeviceStatus device_status = 20;

}

message DeviceStatus {
  // Processed data (JSON string containing decoded sensor readings).
  google.protobuf.Value data = 1;
  // Last seen at timestamp.
  google.protobuf.Timestamp last_seen_at = 2;
   //is online 
  bool is_online = 3;
}

// message DeviceListItem {
//   // ID
//   string id = 1;
//   // EUI (EUI64).
//   string eui = 2;

//   // Created at timestamp.
//   google.protobuf.Timestamp created_at = 3;

//   // Last update timestamp.
//   google.protobuf.Timestamp updated_at = 4;

//   // Name.
//   string name = 5;

//   // Description.
//   string description = 6;

//   // Device-profile ID (UUID).
//   string device_profile_id = 7;

//   DeviceStatus device_status = 8;

//   // Device tags.
//   map<string, string> tags = 9;

//   //locations
//   Location location = 10;
// }

message CreateDeviceRequest {
  // Device object.
  Device device = 1;
}

message CreateDeviceResponse {
  // ID.
  string id = 1;
}

message GetDeviceRequest {
  // ID.
  string id = 1;
}

message GetDeviceResponse {
  // Device object.
  Device device = 1;

}

message UpdateDeviceRequest {
  // Device object.
  Device device = 1;
}

message DeleteDeviceRequest {
  // EUI (EUI64).
  string id = 1;
}

message ListDevicesRequest {
  // Max number of devices to return in the result-set.
  // If not set, it will be treated as 0, and the response will only return the total_count.
  uint32 limit = 1;

  // Offset in the result-set (for pagination).
  uint32 offset = 2;

  // If set, the given string will be used to search on name (optional).
  string search = 3;

  // Tenant ID (UUID) to filter devices on.
  string tenant_id = 4;

  // Application ID (UUID) to filter devices on.
  string application_id = 5;

  // Asset Type to filter devices on.
  AssetType asset_type = 6;

  // Asset Sub Type to filter devices on.
  AssetSubType asset_sub_type = 7;

  // Device type to filter devices on.
  DeviceType device_type = 8;

  TransportProtocol transport_protocol = 9;

  enum OrderBy {
    NAME = 0;
    EUI = 1;
    LAST_SEEN_AT = 2;
    DEVICE_PROFILE_NAME = 3;
  }

  // If set, the given value will be used to sort by (optional).
  OrderBy order_by = 10;

  // If set, the sorting direction will be decending (default = ascending) (optional).
  bool order_by_desc = 11;

  // Tags to filter devices on.
  map<string, string> tags = 12;

}

message ListDevicesResponse {
  // Total number of devices.
  uint32 total_count = 1;

  // Result-set.
  repeated Device result = 2;
}
