syntax = "proto3";

package platform;

import "google/api/annotations.proto";
import "google/protobuf/empty.proto";
import "google/protobuf/timestamp.proto";
import "platform/shared_enums.proto";
import "google/protobuf/struct.proto";

option go_package = "github.com/adarko-io/platform-api/go/v4/platform";

// InventoryService manages device inventory, provisioning, and device-specific configurations.
// Devices must exist in inventory before they can be added to the device service.
service InventoryService {
  // Create a new device in inventory.
  rpc Create(CreateInventoryDeviceRequest) returns (CreateInventoryDeviceResponse) {
    option (google.api.http) = {
      post: "/api/inventory/devices",
      body: "*",
    };
  }

  // Get device from inventory by EUI.
  rpc Get(GetInventoryDeviceRequest) returns (GetInventoryDeviceResponse) {
    option (google.api.http) = {
      get: "/api/inventory/devices/{id}",
    };
  }

  // Update device in inventory.
  rpc Update(UpdateInventoryDeviceRequest) returns (google.protobuf.Empty) {
    option (google.api.http) = {
      put:  "/api/inventory/devices/{inventory.id}",
      body: "*",
    };
  }

  // Delete device from inventory.
  rpc Delete(DeleteInventoryDeviceRequest) returns (google.protobuf.Empty) {
    option (google.api.http) = {
      delete: "/api/inventory/devices/{id}",
    };
  }

  // List devices in inventory with filtering.
  rpc List(ListInventoryDevicesRequest) returns (ListInventoryDevicesResponse) {
    option (google.api.http) = {
      get: "/api/inventory/devices",
    };
  }

  // Update device status (onboarded/provisioned).
  rpc UpdateStatus(UpdateDeviceStatusRequest) returns (google.protobuf.Empty) {
    option (google.api.http) = {
      put:  "/api/inventory/devices/{id}/status",
      body: "*",
    };
  }

  // Bulk import devices to inventory.
  rpc BulkImport(BulkImportRequest) returns (BulkImportResponse) {
    option (google.api.http) = {
      post: "/api/inventory/devices/bulk-import",
      body: "*",
    };
  }

  //Create New Manufacturer
  rpc CreateManufacturer(CreateManufacturerRequest) returns (CreateManufacturerResponse) {
    option (google.api.http) = {
      post: "/api/inventory/manufacturers",
      body: "*",
    };
  }

  //List Manufacturers
  rpc ListManufacturers(ListManufacturersRequest) returns (ListManufacturersResponse) {
    option (google.api.http) = {
      get: "/api/inventory/manufacturers",
    };
  }

  //Delete Manufacturer
  rpc DeleteManufacturer(DeleteManufacturerRequest) returns (google.protobuf.Empty) {
    option (google.api.http) = {
      delete: "/api/inventory/manufacturers/{id}",
    };
  }

  //Update Manufacturer
  rpc UpdateManufacturer(UpdateManufacturerRequest) returns (google.protobuf.Empty) {
    option (google.api.http) = {
      put: "/api/inventory/manufacturers/{manufacturer.id}",
      body: "*",
    };
  } 

  //Get Manufacturer
  rpc GetManufacturer(GetManufacturerRequest) returns (GetManufacturerResponse) {
    option (google.api.http) = {
      get: "/api/inventory/manufacturers/{id}",
    };
  }

}

// InventoryDevice represents a device in the inventory with all necessary configuration.
message InventoryDevice {

  //id
  string id = 16;

  // EUI (EUI64) - Primary identifier.
  string eui = 1;

  // Serial number.
  string serial_number = 2;

  // Device name/model.
  string name = 3;

  // Device description.
  string description = 4;

  // Current inventory status.
  InventoryStatus status = 5;

  // Manufacturer information.
  string manufacturer_id = 6;

  // Device type specific configuration JSON.
  google.protobuf.Value configuration = 7;

 //Device Type LoRaWAN Gateway, LoRaWAN Device, Cellular Device, Wifi etc.
  DeviceType device_type = 8;

 //Asset Type Water Meter, Gas Meter, Energy Meter etc.
  AssetType asset_type = 9;

  AssetSubType asset_sub_type = 10;

  TransportProtocol transport_protocol = 11;

  // Device tags/labels.
  map<string, string> tags = 12;

  // Additional metadata.
  map<string, string> metadata = 13;

  // Batch/lot information.
  string batch_id = 14;
}

// NOTE: Enums moved to shared_enums.proto to avoid conflicts between services.


// Request/Response messages.
message CreateInventoryDeviceRequest {
  // Device to create.
  InventoryDevice inventory = 1;
}

message CreateInventoryDeviceResponse {
  // Inventory ID.
  string id = 1;
}

message GetInventoryDeviceRequest {
  // Inventory ID.
  string id = 1;
}

message GetInventoryDeviceResponse {
  // Device information.
  InventoryDevice inventory = 1;

  // Created at timestamp.
  google.protobuf.Timestamp created_at = 2;

  // Last update timestamp.
  google.protobuf.Timestamp updated_at = 3;
}

message UpdateInventoryDeviceRequest {
  // Device to update.
  InventoryDevice inventory = 1;
}

message DeleteInventoryDeviceRequest {
  // Inventory ID.
  string id = 1;
}

message ListInventoryDevicesRequest {
  // Maximum number of devices to return.
  uint32 limit = 1;

  // Offset for pagination.
  uint32 offset = 2;

  // Search query (name, description, etc.).
  string search = 3;

  // Filter by tags.
  map<string, string> tags = 4;
}

message InventoryDeviceListItem {

  //Inventory ID
  string id = 1;

  // Device EUI.
  string eui = 2;

  // Device name.
  string name = 3;

  // Serial number.
  string serial_number = 4;

  // Current status.
  InventoryStatus status = 5;

  // Model.
  string model = 6;

 //Device Type LoRaWAN Gateway, LoRaWAN Device, Cellular Device, Wifi etc.
  DeviceType device_type = 7;

 //Asset Type Water Meter, Gas Meter, Energy Meter etc.
  AssetType asset_type = 8;

  AssetSubType asset_sub_type = 9;

  //Manufacturer ID
  string manufacturer_id = 10;

  // Created at timestamp.
  google.protobuf.Timestamp created_at = 11;

  // Last update timestamp.
  google.protobuf.Timestamp updated_at = 12;
}

message ListInventoryDevicesResponse {
  // Total count.
  uint32 total_count = 1;

  // Device list.
  repeated InventoryDeviceListItem devices = 2;
}

message UpdateDeviceStatusRequest {
  //  Inventory ID.
  string id = 1;

  // New status.
  InventoryStatus status = 2;

  // Status update reason/notes.
  string notes = 3;
}

message BulkImportRequest {
  // Devices to import.
  repeated InventoryDevice devices = 1;

  // Skip devices that already exist.
  bool skip_existing = 2;
}

message BulkImportResponse {
  // Number of devices successfully imported.
  uint32 imported_count = 1;

  // Number of devices skipped.
  uint32 skipped_count = 2;

  // Number of devices failed.
  uint32 failed_count = 3;

  // Import errors.
  repeated ImportError errors = 4;
}

message ImportError {
  //  Inventory ID that failed.
  string id = 1;

  // Error message.
  string error = 2;
}

message Manufacturer {
  // Manufacturer ID.
  string id = 1;

  // Manufacturer name.
  string name = 2;

 // Model number/SKU.
  string model = 3;

  // Hardware version.
  string hardware_version = 4;

  // Firmware version.
  string firmware_version = 5;

  // Created at timestamp.
  google.protobuf.Timestamp created_at = 6;

  // Last update timestamp.
  google.protobuf.Timestamp updated_at = 7;
}

message CreateManufacturerRequest {
  // Manufacturer to create.
  Manufacturer manufacturer = 1;
}
message CreateManufacturerResponse {
  // Manufacturer ID.
  string id = 1;
}

message ListManufacturersRequest {
  // Maximum number of manufacturers to return.
  uint32 limit = 1;

  // Offset for pagination.
  uint32 offset = 2;

  // Search query (name, model, etc.).
  string search = 3;
}

message ListManufacturersResponse {
  // Total count.
  uint32 total_count = 1;

  // Manufacturer list.
  repeated Manufacturer manufacturers = 2;
}

message DeleteManufacturerRequest {
  // Manufacturer ID.
  string id = 1;
}

message UpdateManufacturerRequest {
  // Manufacturer to update.
  Manufacturer manufacturer = 1;
}

message GetManufacturerRequest {
  // Manufacturer ID.
  string id = 1;
}
message GetManufacturerResponse {
  // Manufacturer information.
  Manufacturer manufacturer = 1;
}
